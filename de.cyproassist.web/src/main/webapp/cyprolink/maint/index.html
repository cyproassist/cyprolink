<div data-lift="surround?with=default;at=content"
	prefix="
	rdf: http://www.w3.org/1999/02/22-rdf-syntax-ns#
	foaf: http://xmlns.com/foaf/0.1/ 
	owl: http://www.w3.org/2002/07/owl#
	rdfs: http://www.w3.org/2000/01/rdf-schema#
	dcterms: http://purl.org/dc/terms/
	lf-maint: http://linkedfactory.org/vocab/maintenance#
	">

	<link rel="stylesheet" type="text/css" href="../css/app.css"
		data-lift="head"></link>

	<style type="text/css" data-lift="head">
#items>section:nth-child(2n+1) {
	background-color: #F9F9F9;
}

#items {
	margin-bottom: 1em;
}

.content {
	padding: 5px;
}

.content.actions {
	text-align: right;
}

.search-form {
	margin: 0;
	margin-right: 25px;
}

.label {
	color: white;
}
</style>
	<script data-lift="head">
		$(function() {
			// initialize language input from query parameters
			var $language = $('.language');

			var params = enilink.params();
			if (params.lang) {
				$language.val(params.lang);
			}

			// hide non-relevant texts according to current language
			var lang = $language.val();

			$("#btn-add-item").click(function(e) {
				enilink.render("cyprolink/maint/new-event", {
					model : enilink.contextModel(this)
				}, function(html) {
					var div = $("#modal");
					div.html(html);
					div.find(".modal").modal("show");
				});
			});

			$(document).on("event-created", function(evt, uri) {
				var items = $("#items");
				enilink.render({
					template : "item",
					bind : {
						item : uri
					}
				}, {
					model : enilink.contextModel(items)
				}, function(html) {
					var newItem = $(html);

					newItem.each(prepareItem);
					enilink.ui.enableAdd(newItem.find('[data-add]'));
					items.append(newItem);
				});
				$("#modal .modal").modal("hide");
			});

			$language.change(function() {
				params.lang = $(this).val();
				window.location.search = enilink.encodeParams(params);
			});

			function prepareItem() {
				// set correct language for new elements
				$(this).find('[data-add="text"]').attr('data-lang', lang);
				
				var types = $(this).find('[rel="rdf:type"] [resource]').map(
						function() {
							return $(this).attr('resource');
						}).get().join(' ').toLowerCase();

				var labelType = 'info';
				if (types.includes('fault')) {
					labelType = 'danger';
				} else if (types.includes('warning')) {
					labelType = 'warning';
				}

				$(this).find('.label').addClass('label-' + labelType);
			}

			// Add label classes for each event type			
			$('.item').each(prepareItem);
		});
	</script>

	<script data-lift="JS.templates"></script>
	<script data-lift="JS.rdfa"></script>

	<div data-lift="cyprolink/rdfaUtils.orderby">
		<!-- use lang as param to filter non-relevant texts -->
		<div data-lift="rdfa" data-params="?lang"
			data-bind="if(bound(?lang), ?lang, &quot;de&quot;) as ?currentLang">
			<h3 style="display: inline-block">Events</h3>

			<div style="text-align: right; display: flex" class="pull-right">
				<div class="search-form"></div>

				<div>
					<select class="form-control language">
						<option value="de">Deutsch</option>
						<option value="en">Englisch</option>
					</select>
				</div>
			</div>
			<div class="clearfix"></div>

			<section class="row header-top">
				<div class="col-md-2">
					<h4 data-orderby="item">Name</h4>
				</div>
				<div class="col-md-2">
					<h4 data-orderby="nr!asc">Nummer</h4>
				</div>
				<div class="col-md-6">
					<h4>Text</h4>
				</div>
				<div class="col-md-2">
					<h4></h4>
				</div>
			</section>

			<div id="items">
				<section data-t="item" about="?item" class="item">
					<div rel="rdf:type">
						<div class="union clearable">
							<div resource="lf-maint:Event"></div>
							<div resource="lf-maint:Fault"></div>
							<div resource="lf-maint:Warning"></div>
							<div resource="lf-maint:Information"></div>
						</div>
						<div resource="?type"></div>
					</div>

					<div class="row">
						<div class="col-md-2">
							<div class="content">
								<h4 class="header-fluid" data-orderby="item">Name</h4>

								<div>
									<a href="{app}/maint/event?resource={}"
										data-lift="rdf.ref?to=href"><span class="label"> <span
											data-lift="rdf.name"></span></span></a>
								</div>
							</div>
						</div>
						<div class="col-md-2 optional">
							<div class="content">
								<h4 class="header-fluid" data-orderby="nr">Nummer</h4>
								<div property="lf-maint:nr" content="?nr" data-lift="rdf.label"></div>
							</div>
						</div>
						<div class="col-md-6 optional">
							<div class="content" data-filter="lang(?text) = ?currentLang">
								<h4 class="header-fluid">Text</h4>
								<div property="lf-maint:text" content="?searchText"
									class="clearable"></div>

								<div property="lf-maint:text" content="?text" class="editable"
									data-t="text" style="display: inline-box">
									<span data-lift="rdf.label"></span>
								</div>

								<!-- a simple add button -->
								<div data-property="lf-maint:text" data-add="text">
									<i class="glyphicon glyphicon-plus"></i>
								</div>
							</div>
						</div>
						<div class="col-md-2">
							<div class="content actions">
								<a class="btn-delete-item btn-hover" href="javascript://"
									data-lift="cyprolink/events.delete"><i
									class="glyphicon glyphicon-trash"></i></a> <a class="btn-hover"
									href="{app}/describe?model={model}&resource={}"
									data-lift="rdf.ref?to=href"><i
									class="glyphicon glyphicon-edit"></i></a>
							</div>
						</div>
					</div>
				</section>
			</div>

			<section>
				<a id="btn-add-item" class="btn btn-default btn-small"
					href="javascript:void(0)"><i class="glyphicon glyphicon-plus"></i>
					Create</a>
			</section>
			<div id="modal"></div>
			<div data-for="?item" data-items="10" class="paginator"></div>
			<div data-lift="embed?what=editsupport"></div>

			<!-- textarea class="col-md-12 query"></textarea -->

			<div class="search-patterns" data-for="?item ?searchText"
				data-param="q"></div>
		</div>
	</div>
</div>